DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS article CASCADE;
DROP TABLE IF EXISTS reply CASCADE;

CREATE TABLE IF NOT EXISTS users
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY ,
    username    VARCHAR (40) NOT NULL COMMENT '로그인ID',
    password    VARCHAR (255) NOT NULL,
    nickname    VARCHAR (20) NOT NULL UNIQUE,
    email       VARCHAR (40) NOT NULL,
    created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(3),
    updated_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),

    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS article
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY,
    title       VARCHAR (30) NOT NULL,
    user_id     BIGINT NOT NULL,
    writer      VARCHAR (20) NOT NULL,
    contents    TEXT,
    created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(3),
    updated_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),

    PRIMARY KEY (id),
    FOREIGN KEY (user_id) REFERENCES users (id)
);

CREATE TABLE IF NOT EXISTS reply
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY,
    article_id BIGINT NOT NULL ,
    user_id BIGINT NOT NULL ,
    writer VARCHAR (20) NOT NULL ,
    comments VARCHAR (255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP(3),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),

    PRIMARY KEY (id),
    FOREIGN KEY (article_id) REFERENCES article (id),
    FOREIGN KEY (user_id) REFERENCES users (id)
);

INSERT INTO users (username, password, nickname, email) values ('hs1107', 'a123123123', 'sungbin', 'sungbin@naver.com');

INSERT INTO article (title, user_id, writer, contents) VALUES ( '제목', 1, 'sungbin', '본문');

INSERT INTO reply (article_id, user_id, writer, comments) VALUES ( 1, 1, 'sungbin', '댓글1');
INSERT INTO reply (article_id, user_id, writer, comments) VALUES ( 1, 1, 'sungbin', '댓글2');
INSERT INTO reply (article_id, user_id, writer, comments) VALUES ( 1, 1, 'sungbin', '댓글3');